# WAN2.2-T2V-A14B (27B MOE) æ¨¡å‹ä½¿ç”¨è¯´æ˜

## æ¦‚è¿°
è¿™æ˜¯WAN2.2-T2V-A14Bï¼ˆText-to-Videoï¼‰æ¨¡å‹çš„ä»£ç ä»“åº“ã€‚æ­¤ä»“åº“**ä»…åŒ…å«æ¨¡å‹ä»£ç å’Œé…ç½®æ–‡ä»¶**ï¼Œä¸åŒ…å«æ¨¡å‹æƒé‡ï¼Œä»¥é¿å…æœ¬åœ°å­˜å‚¨å’Œè¿è¡Œå¤§å‹MOEæ¨¡å‹ã€‚

## ğŸ—ï¸ æ¨¡å‹æ¶æ„ç‰¹ç‚¹

### MOEï¼ˆMixture of Expertsï¼‰æ¶æ„
- **æ€»å‚æ•°é‡**: 27Bï¼ˆ270äº¿å‚æ•°ï¼‰
- **æ¿€æ´»å‚æ•°**: 14Bï¼ˆæ¯æ¬¡æ¨ç†åªæ¿€æ´»ä¸€ä¸ªä¸“å®¶ï¼‰
- **ä¸“å®¶åˆ†å·¥**:
  - **é«˜å™ªå£°ä¸“å®¶**: å¤„ç†æ‰©æ•£è¿‡ç¨‹æ—©æœŸé˜¶æ®µï¼ˆæ•´ä½“å¸ƒå±€å’Œè¿åŠ¨ï¼‰
  - **ä½å™ªå£°ä¸“å®¶**: å¤„ç†æ‰©æ•£è¿‡ç¨‹åæœŸé˜¶æ®µï¼ˆç»†èŠ‚ä¼˜åŒ–ï¼‰
- **åˆ‡æ¢æœºåˆ¶**: åŸºäºä¿¡å™ªæ¯”(SNR)è‡ªåŠ¨é€‰æ‹©ä¸“å®¶

## ğŸ“ ç›®å½•ç»“æ„
```
WAN2.2-27B/
â”œâ”€â”€ Wan2.2-T2V-A14B/                    # T2V-A14Bæ¨¡å‹ä»“åº“
â”‚   â”œâ”€â”€ high_noise_model/               # é«˜å™ªå£°ä¸“å®¶æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ config.json                 # é«˜å™ªå£°ä¸“å®¶é…ç½®
â”‚   â”‚   â””â”€â”€ diffusion_pytorch_model.safetensors.index.json  # æƒé‡ç´¢å¼•
â”‚   â”œâ”€â”€ low_noise_model/                # ä½å™ªå£°ä¸“å®¶æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ config.json                 # ä½å™ªå£°ä¸“å®¶é…ç½®
â”‚   â”‚   â””â”€â”€ diffusion_pytorch_model.safetensors.index.json  # æƒé‡ç´¢å¼•
â”‚   â”œâ”€â”€ google/umt5-xxl/                # T5æ–‡æœ¬ç¼–ç å™¨
â”‚   â”œâ”€â”€ assets/                         # èµ„æºæ–‡ä»¶
â”‚   â”œâ”€â”€ configuration.json              # æ¨¡å‹æ€»é…ç½®
â”‚   â””â”€â”€ README.md                       # å®˜æ–¹æ–‡æ¡£
â”œâ”€â”€ download_T2V_A14B_weights.py        # Pythonä¸‹è½½è„šæœ¬
â”œâ”€â”€ download_T2V_A14B_weights.bat       # Windowsä¸‹è½½è„šæœ¬
â””â”€â”€ WAN2.2-T2V-A14Bä½¿ç”¨è¯´æ˜.md          # æœ¬æ–‡æ¡£
```

## ğŸ“¥ ä¸‹è½½æ¨¡å‹æƒé‡

### æ–¹æ³•ä¸€ï¼šä½¿ç”¨Pythonè„šæœ¬ï¼ˆæ¨èï¼‰
```bash
python download_T2V_A14B_weights.py
```

### æ–¹æ³•äºŒï¼šä½¿ç”¨Windowsæ‰¹å¤„ç†è„šæœ¬
```bash
download_T2V_A14B_weights.bat
```

### æ–¹æ³•ä¸‰ï¼šæ‰‹åŠ¨ä½¿ç”¨Hugging Face CLI
```bash
# å®‰è£…ä¾èµ–
pip install huggingface_hub[cli]

# ä¸‹è½½åˆ°æŒ‡å®šç›®å½•
huggingface-cli download Wan-AI/Wan2.2-T2V-A14B --local-dir ./T2V_A14B_weights
```

### æ–¹æ³•å››ï¼šä½¿ç”¨Git LFSï¼ˆå¦‚æœåœ¨ä»“åº“ç›®å½•ä¸­ï¼‰
```bash
# å®‰è£…Git LFS
git lfs install

# è¿›å…¥æ¨¡å‹ç›®å½•å¹¶æ‹‰å–LFSæ–‡ä»¶
cd Wan2.2-T2V-A14B
git lfs pull
```

## âš ï¸ é‡è¦æ³¨æ„äº‹é¡¹

### ğŸš« æœ¬åœ°è¿è¡Œé™åˆ¶
- **ä¸¥ç¦åœ¨æœ¬åœ°è¿è¡Œæ­¤æ¨¡å‹**
- æ¨¡å‹æ–‡ä»¶éå¸¸å¤§ï¼ˆçº¦111GBï¼‰
- éœ€è¦80GB+çš„GPUæ˜¾å­˜
- æ¨èä»…åœ¨è¿œç¨‹æœåŠ¡å™¨æˆ–äº‘å¹³å°ä¸Šè¿è¡Œ

### ğŸ’¾ å­˜å‚¨éœ€æ±‚
| ç»„ä»¶ | å¤§å° | è¯´æ˜ |
|------|------|------|
| é«˜å™ªå£°ä¸“å®¶æ¨¡å‹ | ~53GB | å¤„ç†æ—©æœŸæ‰©æ•£é˜¶æ®µ |
| ä½å™ªå£°ä¸“å®¶æ¨¡å‹ | ~53GB | å¤„ç†åæœŸæ‰©æ•£é˜¶æ®µ |
| T5ç¼–ç å™¨ | ~4GB | æ–‡æœ¬ç†è§£ç»„ä»¶ |
| VAEç¼–ç å™¨ | ~1GB | è§†è§‰ç¼–ç ç»„ä»¶ |
| **æ€»è®¡** | **~111GB** | **å®Œæ•´æ¨¡å‹å¤§å°** |

### ğŸ–¥ï¸ ç¡¬ä»¶è¦æ±‚ï¼ˆä»…ä¾›å‚è€ƒï¼Œè¯·å‹¿æœ¬åœ°è¿è¡Œï¼‰
- **GPU**: NVIDIA A100 80GB æˆ–æ›´é«˜
- **RAM**: 64GB+
- **å­˜å‚¨**: 150GB+ å¯ç”¨ç©ºé—´
- **å¤šGPU**: æ”¯æŒ2-8å¡å¹¶è¡Œæ¨ç†
- **CUDA**: 11.8+
- **Python**: 3.8+

## ğŸŒ æ¨èçš„è¿œç¨‹è¿è¡Œå¹³å°

1. **å¯æ™ºç®—åŠ›å¹³å°** - æä¾›A100ç­‰é«˜ç«¯GPUèµ„æº
2. **å…±ç»©ç®—åŠ›** - æ”¯æŒå®¹å™¨åŒ–éƒ¨ç½²
3. **é˜¿é‡Œäº‘PAI** - ä¼ä¸šçº§AIè®¡ç®—å¹³å°
4. **è…¾è®¯äº‘TI** - ä¸“ä¸šAIè®­ç»ƒæ¨ç†å¹³å°
5. **AWS/Azure/GCP** - å›½é™…äº‘è®¡ç®—å¹³å°

## ğŸš€ æ¨ç†æ€§èƒ½

### å•GPUæ¨ç†ï¼ˆA100 80GBï¼‰
- **ç”Ÿæˆæ—¶é—´**: çº¦8-12åˆ†é’Ÿ/è§†é¢‘ï¼ˆ720P, 5ç§’ï¼‰
- **å†…å­˜å ç”¨**: 70-75GBæ˜¾å­˜
- **æ¨èå‚æ•°**: `--offload_model True --convert_model_dtype`

### å¤šGPUæ¨ç†ï¼ˆ2-8å¡A100ï¼‰
- **ç”Ÿæˆæ—¶é—´**: çº¦3-6åˆ†é’Ÿ/è§†é¢‘ï¼ˆ720P, 5ç§’ï¼‰
- **å¹¶è¡Œç­–ç•¥**: FSDP + DeepSpeed Ulysses
- **æ¨èå‚æ•°**: `--dit_fsdp --t5_fsdp --ulysses_size 4`

## ğŸ¯ MOEä¸“å®¶åˆ‡æ¢æœºåˆ¶

```python
# ä¸“å®¶é€‰æ‹©åŸºäºä¿¡å™ªæ¯”(SNR)
if SNR >= threshold:
    # ä½¿ç”¨é«˜å™ªå£°ä¸“å®¶ï¼ˆæ—©æœŸé˜¶æ®µï¼‰
    active_expert = "high_noise_model"
else:
    # ä½¿ç”¨ä½å™ªå£°ä¸“å®¶ï¼ˆåæœŸé˜¶æ®µï¼‰  
    active_expert = "low_noise_model"
```

## ğŸ“Š ä¸å…¶ä»–æ¨¡å‹å¯¹æ¯”

| æ¨¡å‹ | å‚æ•°é‡ | æ¶æ„ | æ¿€æ´»å‚æ•° | æ¨ç†æ•ˆç‡ |
|------|--------|------|----------|----------|
| WAN2.2-TI2V-5B | 5B | Dense | 5B | â­â­â­â­â­ |
| **WAN2.2-T2V-A14B** | **27B** | **MOE** | **14B** | â­â­â­ |
| å…¶ä»–T2Væ¨¡å‹ | 10-20B | Dense | 10-20B | â­â­ |

## ğŸ”§ æ¨ç†å‘½ä»¤ç¤ºä¾‹

```bash
# å•GPUæ¨ç†ï¼ˆéœ€è¦80GB+æ˜¾å­˜ï¼‰
python generate.py --task t2v-A14B --size 1280*720 \
    --ckpt_dir ./T2V_A14B_weights \
    --offload_model True --convert_model_dtype \
    --prompt "A beautiful sunset over the ocean"

# å¤šGPUæ¨ç†ï¼ˆ4å¡ï¼‰
torchrun --nproc_per_node=4 generate.py --task t2v-A14B \
    --size 1280*720 --ckpt_dir ./T2V_A14B_weights \
    --dit_fsdp --t5_fsdp --ulysses_size 4 \
    --prompt "A beautiful sunset over the ocean"
```

## ğŸ“„ è®¸å¯è¯
è¯·å‚è€ƒåŸå§‹ä»“åº“çš„Apache 2.0è®¸å¯è¯æ–‡ä»¶ã€‚

## ğŸ†˜ æŠ€æœ¯æ”¯æŒ
å¦‚æœ‰é—®é¢˜ï¼Œè¯·å‚è€ƒï¼š
1. å®˜æ–¹README.mdæ–‡æ¡£
2. Hugging Faceæ¨¡å‹é¡µé¢: https://huggingface.co/Wan-AI/Wan2.2-T2V-A14B
3. WANå®˜æ–¹æŠ€æœ¯è®ºæ–‡: arXiv:2503.20314

---
**å†æ¬¡æé†’ï¼šæ­¤ä»“åº“ä»…ç”¨äºä»£ç ç ”ç©¶ï¼Œè¯·å‹¿åœ¨æœ¬åœ°è¿è¡Œ27B MOEæ¨¡å‹ï¼**
